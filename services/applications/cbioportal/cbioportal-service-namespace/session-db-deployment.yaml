---
apiVersion: apps/v1
kind: Deployment
metadata:
  # This name uniquely identifies the Deployment
  name: cbioportal-session-database
  namespace: "services"
spec:
  replicas: 1
  selector:
    matchLabels:
      app-name: cbioportal-session-database
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app-name: cbioportal-session-database
    spec:
      containers:
      - name: cbioportal-session-database
        image: "mongo:4.2"
        imagePullPolicy: Always
        env: # Environment variables
        - name: MONGO_INITDB_DATABASE
          value: session_service
        ports: # Port(s) on which your application runs
          - containerPort: 27017
        resources:
          limits:
            memory: "5Gi"
          requests:
            memory: "100Mi"
        volumeMounts:
          - name: cbioportal-mongo-data # key of volume moment
            mountPath: "/data/db" # path in container
      volumes:
      - name: cbioportal-mongo-data # key of volume mount
        persistentVolumeClaim:
          claimName: cbio-pv-claim
      # imagePullSecrets:
      #   - name: registry-secret
---
apiVersion: v1
kind: Service
metadata:
  name: cbioportal-session-database-service
  namespace: "services"
  labels:
    app-name: cbioportal-session-database
spec:
  selector:
    app-name: cbioportal-session-database
  ports:
    - port: 27017
      targetPort: 27017
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: cbio-pv-claim
  namespace: "services"
spec:
  storageClassName: "host-dir" # Empty string must be explicitly set otherwise default StorageClass will be set
  # volumeName: cbio-pv-volume
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: "5Gi"
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: cbio-pv-volume
  namespace: "services"
  labels:
    type: local
spec:
  storageClassName: "host-dir"
  capacity:
    storage: 10Gi
  accessModes:
    - ReadWriteMany
  hostPath:
    path: "/mnt/cbio-session-mongo"