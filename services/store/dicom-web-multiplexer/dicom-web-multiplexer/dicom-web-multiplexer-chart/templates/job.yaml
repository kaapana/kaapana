apiVersion: batch/v1
kind: Job
metadata:
  name: patch-airflow-scheduler-add-env
  namespace: "{{ .Values.global.services_namespace }}"
  annotations:
    "helm.sh/hook": post-install
spec:
  backoffLimit: 3
  template:
    spec:
      restartPolicy: OnFailure
      containers:
        - name: patch-airflow-scheduler-add-env
          image: "{{ .Values.global.registry_url }}/multiplexer-init:{{ .Values.global.kaapana_build_version }}"
          command: ["python", "start.py", "--post-install"]
          imagePullPolicy: "{{ .Values.global.pull_policy_images }}"
---
apiVersion: batch/v1
kind: Job
metadata:
  name: patch-airflow-scheduler-remove-env
  namespace: "{{ .Values.global.services_namespace }}"
  annotations:
    "helm.sh/hook": pre-delete
spec:
  backoffLimit: 3
  template:
    spec:
      restartPolicy: OnFailure
      containers:
        - name: patch-airflow-scheduler-remove-env
          image: "{{ .Values.global.registry_url }}/multiplexer-init:{{ .Values.global.kaapana_build_version }}"
          command: ["python", "start.py", "--pre-delete"]
